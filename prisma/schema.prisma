generator client {
  provider   = "prisma-client"
  output     = "../lib/prisma"
  engineType = "client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Better Auth models
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  image     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  accounts  Account[]
  sessions  Session[]
  profile   Profile?

  positions Position[]
  candidates Candidate[]
  quizzes Quiz[]

  @@map("user")
}

model Account {
  id              String   @id @default(cuid())
  userId          String
  type            String
  provider        String
  providerAccountId String
  refreshToken    String?
  accessToken     String?
  expiresAt       Int?
  tokenType       String?
  scope           String?
  idToken         String?
  sessionState    String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("account")
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("session")
}

model Verification {
  id         String   @id @default(cuid())
  identifier String
  token      String   @unique
  expires    DateTime
  createdAt  DateTime @default(now())

  @@unique([identifier, token])
  @@map("verification")
}

// App-specific models
model Profile {
  id        String   @id @default(cuid())
  userId    String   @unique
  fullName  String?
  userName  String?
  avatarUrl String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("profiles")
}

model Position {
  id              String   @id @default(cuid())
  title           String
  description     String?
  experienceLevel String
  skills          String[]
  softSkills      String[]
  contractType    String?
  createdBy       String
  createdAt       DateTime @default(now())

  creator   User      @relation(fields: [createdBy], references: [id], onDelete: Cascade)
  candidates Candidate[]
  quizzes   Quiz[]

  @@map("positions")
}

model Candidate {
  id         String   @id @default(cuid())
  name       String
  email      String
  positionId String
  status     String   @default("pending")
  resumeUrl  String?
  createdBy  String
  createdAt  DateTime @default(now())

  position Position @relation(fields: [positionId], references: [id], onDelete: Cascade)
  creator  User     @relation(fields: [createdBy], references: [id], onDelete: Cascade)
  interviews Interview[]

  @@map("candidates")
}

model Quiz {
  id         String   @id @default(cuid())
  title      String
  positionId String
  questions  Json
  timeLimit  Int?
  createdBy  String
  createdAt  DateTime @default(now())

  position  Position   @relation(fields: [positionId], references: [id], onDelete: Cascade)
  creator   User       @relation(fields: [createdBy], references: [id], onDelete: Cascade)
  interviews Interview[]

  @@map("quizzes")
}

model Interview {
  id           String   @id @default(cuid())
  candidateId  String
  quizId       String
  status       String   @default("pending")
  startedAt    DateTime?
  completedAt  DateTime?
  score        Float?
  answers      Json?
  token        String   @unique
  createdAt    DateTime @default(now())

  candidate Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  quiz      Quiz      @relation(fields: [quizId], references: [id], onDelete: Cascade)

  @@map("interviews")
}
